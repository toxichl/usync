!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Usync",[],e):"object"==typeof exports?exports.Usync=e():t.Usync=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1);t.exports=n.Usync},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=r(2),o=r(3);!function(t){t[t.READY=0]="READY",t[t.PENDING=1]="PENDING",t[t.FULFILLED=2]="FULFILLED",t[t.REJECTED=3]="REJECTED"}(n||(n={}));var s=function(){function t(t,e){this.vessel={},this.lifecycleList=o.default.init(),this.root=Array.isArray(t)?t:"string"==typeof t?this.setName(t)&&{}:"object"==typeof t?[t]:{},e=i.assign({},e),e.name&&this.setName(e.name),this.root.$name=this.__name__,this.defferd=[],this.index=-1,this.state=n.READY}return t.prototype.fulfilledBroadcast=function(){},Object.defineProperty(t.prototype,"currentDefferd",{get:function(){return this.defferd[this.index]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prevDefferd",{get:function(){return this.defferd[this.index-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextDefferd",{get:function(){return this.defferd[this.index+1]},enumerable:!0,configurable:!0}),t.prototype.setName=function(t){return this.__name__=t,this},Object.defineProperty(t.prototype,"name",{get:function(){return this.__name__},enumerable:!0,configurable:!0}),t.prototype.use=function(t){if(Array.isArray(t)){for(var e=0,r=t;e<r.length;e++){var i=r[e];this.use(i)}return this}return this.defferd.push(t),1===this.defferd.length?(this.state=n.PENDING,this.index=0):this.defferd[this.defferd.length-2].__state__===n.FULFILLED&&this.then(),this},t.prototype.then=function(){var e=this;this.currentDefferd.startTime=(new Date).getTime();var r=[this.root].concat(this.done.bind(this));try{if(this.setRootProperty(),this.runHookByName("taskStart"),"function"==typeof this.currentDefferd){var n=this.currentDefferd.apply(this,r);n instanceof Promise&&n.then(function(){e.done.call(e)}).catch(function(t){throw t})}else this.currentDefferd instanceof t&&(this.currentDefferd.fulfilledBroadcast=this.done.bind(this),this.currentDefferd.start())}catch(t){if(!this.vessel.catch)throw new Error(t);var i=[t].concat([this.root],this.done.bind(this));this.vessel.catch.apply(this,i)}},t.prototype.setRootProperty=function(){this.root.$current=this.currentDefferd,this.root.$prev=this.prevDefferd,this.root.$next=this.nextDefferd},t.prototype.done=function(){if(this.currentDefferd.__state__=n.FULFILLED,this.currentDefferd.endTime=(new Date).getTime(),this.setRootProperty(),this.runHookByName("taskEnd"),++this.index===this.defferd.length)return this.state=n.FULFILLED,this.defferd=[],this.index=-1,this.runHookByName("appEnd"),void("function"==typeof this.fulfilledBroadcast&&this.fulfilledBroadcast());void 0!==this.currentDefferd&&void 0===this.currentDefferd.__state__&&this.then()},t.prototype.catch=function(t){return this.vessel.catch=t,this},t.prototype.start=function(){this.runHookByName("appStart"),this.startTime=(new Date).getTime(),this.then()},t.prototype.runHookByName=function(t){new Function("this.lifecycleList."+t+"Quene.forEach(start => start.call(this, this.root))\n        if (this.proto.lifecycleList) {\n            var "+t+"Quene = this.proto.lifecycleList."+t+"Quene\n            "+t+"Quene.forEach(start => start.call(this, this.root))\n        }").call(this)},Object.defineProperty(t.prototype,"proto",{get:function(){return Object.getPrototypeOf(this)},enumerable:!0,configurable:!0}),t.prototype.extend=function(t){for(var e=0,r=Object.keys(this.lifecycleList);e<r.length;e++){var n=r[e],i=n.replace("Quene","");t[i]&&this.lifecycleList[n].push(t[i])}},t.app=function(e){return new t(e)},t.extend=function(e){t.prototype.lifecycleList=o.default.init(),t.prototype.extend.call(t.prototype,e)},t}();e.Usync=s},function(t,e,r){"use strict";function n(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(null==t)throw new TypeError("Cannot convert undefined or null to object");t=Object(t);for(var n=0;n<e.length;n++){var i=e[n];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t}Object.defineProperty(e,"__esModule",{value:!0}),e.assign=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={appStart:1,taskStart:2,taskEnd:3,appEnd:4};e.default={init:function(){for(var t={},e=0,r=Object.keys(n);e<r.length;e++){t[r[e]+"Quene"]=[]}return t}}}])});
//# sourceMappingURL=Usync.min.js.map