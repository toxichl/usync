!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.D=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();return function(){function i(){t(this,i),this.$state=0,arguments[0]?this.$core=Array.isArray(arguments[0])?arguments[0]:[arguments[0]]:this.$core=[{}],this.$core[0].$done||(this.$core[0].next=this.$done.bind(this)),this.$Defferd=[],this.$index=-1}return e(i,[{key:"use",value:function(t){return this.$Defferd.push(t),1===this.$Defferd.length?(this.$state=1,this.$index=0):2===this.$Defferd[this.$Defferd.length-2].__state__&&this.then(),this}},{key:"then",value:function(){var t=this.$core.concat(this.$done.bind(this));try{"function"==typeof this.$curDefferd?this.$curDefferd.apply(this,t):this.$curDefferd instanceof i&&(this.$curDefferd.FULFILLED_BROADCAST=this.$done.bind(this),console.log("Start Child Task"),this.$curDefferd.start())}catch(t){if(!this._catch)throw new Error(t);var e=[t].concat(this.$core,this.$done.bind(this));this._catch.apply(this,e)}}},{key:"$done",value:function(){if(this.$curDefferd.__state__=2,++this.$index===this.$Defferd.length)return this.$state=2,this.$Defferd=[],this.$index=-1,void("function"==typeof this.FULFILLED_BROADCAST&&this.FULFILLED_BROADCAST());void 0!==this.$curDefferd&&void 0===this.$curDefferd.__state__&&this.then()}},{key:"catch",value:function(t){return this._catch=t,this}},{key:"start",value:function(){this.then()}},{key:"$curDefferd",get:function(){return this.$Defferd[this.$index]}}],[{key:"app",value:function(t){return new i(t)}}]),i}()});
