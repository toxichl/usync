{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap ff67d7b11334c34708a3","webpack:///./src/Usync.ts","webpack:///./src/utils.ts"],"names":[],"mappings":"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","file":"Usync.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Usync\"] = factory();\n\telse\n\t\troot[\"Usync\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ff67d7b11334c34708a3","import {assign} from './utils'\nimport {IObject, IOptions, IBaseHandler, IFunction, ILifecycleList, ILifeCycle} from './interface'\n\nenum STATE {\n    READY = 0,\n    PENDING = 1,\n    FULFILLED = 2,\n    REJECTED = 3\n}\n\nconst LIFE_CYCLE = {\n    start: 1,\n    taskStart: 2,\n    taskEnd: 3,\n    end: 4\n}\n\ntype IHandler = Usync | IBaseHandler;\ntype IState = string | IObject | IObject[];\n\nclass Usync {\n\n    private core: IObject;\n    private vessel: IObject;\n    private defferd: IHandler[];\n    private index: number;\n\n    public state: number;\n    public startTime: number;\n    public __name__: string;\n    public __state__: number;\n\n    // Wait to reset value\n    private fulfilledBroadcast() {\n\n    }\n\n    constructor(state: IState, options?: IOptions) {\n\n        this.core = Array.isArray(state) ? state :\n               typeof state === 'string' ? ((this.name(state)) && <IObject>{}) :\n               typeof state === 'object' ? [state] : <IObject>{}\n\n        options = assign({}, options)\n\n        if (<string>options.name) {\n            this.name(options.name)\n        }\n\n        this.core.$name = this.__name__\n\n        this.defferd = []\n        this.index = -1\n        this.state = STATE.READY\n    }\n\n    get currentDefferd() {\n        return <IHandler>this.defferd[this.index]\n    }\n\n    public name(name: string) {\n        this.__name__ = name\n        return this\n    }\n\n    public use(handler: IHandler) {\n\n        this.defferd.push(handler)\n\n        if (this.defferd.length === 1) {\n            this.state = STATE.PENDING\n            this.index = 0\n\n        } else {\n            // Previous task has been FULFILLED, directly to the next task execution\n            if (this.defferd[this.defferd.length - 2].__state__ === STATE.FULFILLED) {\n                this.then()\n            }\n        }\n\n        return this\n    }\n\n    private then() {\n        // Add Support for time record\n        let time = new Date().getTime()\n        this.core.$time = time - this.startTime\n        this.startTime = time\n\n        let argues = [this.core].concat(this.done.bind(this))\n\n        try {\n\n            if (typeof this.currentDefferd === 'function') {\n                this.currentDefferd.apply(this, argues)\n\n            } else if (this.currentDefferd instanceof Usync) {\n                this.currentDefferd.fulfilledBroadcast = this.done.bind(this)\n                this.currentDefferd.start()\n            }\n\n        } catch (err) {\n\n            if (this.catch) {\n                let errArgues = [err].concat([this.core], this.done.bind(this))\n                this.catch.apply(this, errArgues)\n\n            } else {\n                throw new Error(err)\n            }\n\n        }\n    }\n\n    private done() {\n\n        this.currentDefferd.__state__ = STATE.FULFILLED\n        this.index++\n\n        // defferd running finished\n        if (this.index === this.defferd.length) {\n            this.state = STATE.FULFILLED\n            this.defferd = []\n            this.index = -1\n            this.HOOK_END()\n\n            // When a Usync instance set as a child task for another Usync instance\n            // fulfilledBroadcast() will tell the parent it was fulfilled\n            if (typeof this.fulfilledBroadcast === 'function') {\n                this.fulfilledBroadcast()\n            }\n\n            return;\n        }\n\n        // Synchronous task call next,\n        // subsequent task at this time has not yet been push, return directly\n        if (this.currentDefferd === undefined) {\n            return;\n        }\n        // Asynchronous task, subsequent task was already pushed\n        // but didn't execute\n        else if (this.currentDefferd.__state__ === undefined) {\n            this.then()\n        }\n    }\n\n    catch(fn: IFunction) {\n        this.vessel.catch = fn;\n        return this;\n    }\n\n    start() {\n        this.HOOK_START()\n        this.startTime = new Date().getTime()\n        this.then()\n    }\n\n    HOOK_START() {\n        Usync.lifecycleList.start.forEach(start => start.call(this, this.core))\n    }\n\n    HOOK_END() {\n        Usync.lifecycleList.end.forEach(end => end.call(this, this.core))\n    }\n\n    static createApp(state: IState) {\n        return new Usync(state)\n    }\n\n    static lifecycleList: ILifecycleList = (function () {\n        let list = <ILifecycleList>{}\n        for(let cycle of Object.keys(LIFE_CYCLE)){\n            list[cycle] = []\n        }\n        return <ILifecycleList>list;\n    })();\n\n    static lifecycle(hooks: ILifeCycle) {\n        for (let key of Object.keys(Usync.lifecycleList)) {\n            if (hooks[key]) {\n                Usync.lifecycleList[key].push(hooks[key])\n            }\n        }\n    }\n}\n\nexport = Usync;\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/Usync.ts","import {IObject} from './interface'\n\nexport function assign(target: IObject, ...restOb: IObject[]): IObject {\n\n    if (target == null) {\n        throw new TypeError('Cannot convert undefined or null to object');\n    }\n\n    target = Object(target);\n\n    for (var index = 0; index < restOb.length; index++) {\n        var source = restOb[index]\n        if (source != null) {\n            for (var key in source) {\n                if (Object.prototype.hasOwnProperty.call(source, key)) {\n                    target[key] = source[key]\n                }\n            }\n        }\n    }\n\n    return target;\n};\n\n\n// WEBPACK FOOTER //\n// ./src/utils.ts"],"sourceRoot":""}